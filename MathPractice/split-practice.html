<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>數字分解</title>

<!-- 同層放置字體檔：BpmfIansui-Regular.ttf -->
<link rel="preload" as="font" href="BpmfIansui-Regular.ttf" type="font/ttf" crossorigin>

<style>
  /* 字體設定 */
  @font-face {
    font-family: 'BpmfIansui';
    src: url('BpmfIansui-Regular.ttf') format('truetype');
    font-display: swap;
  }

  :root{
    --blue1:#3B82F6; /* 天藍 */
    --blue2:#2563EB; /* 深藍 */
    --ink:#1A365D;   /* 內文字色 */
    --title:#1E40AF; /* 標題色 */
    --ok:#059669;    /* 成功 */
    --no:#DC2626;    /* 失敗 */
  }

  /* 藍色主題背景與全域字體 */
  body{
    font-family:'BpmfIansui',"Noto Sans TC",sans-serif;
    background:linear-gradient(180deg,#E6F0FF 0%,#F7FAFF 100%);
    color:var(--ink);
    text-align:center;
    margin:0; padding:20px;
  }

  h1{ color:var(--title); margin:0 0 10px; text-shadow:1px 1px 2px rgba(0,0,0,0.05);} 
  #subtitle{ color:var(--blue2); margin:6px 0 14px; font-weight:700; }

  /* 共用按鈕樣式（與注音版一致） */
  .btn{
    font-family:'BpmfIansui','Noto Sans TC',sans-serif !important;
    font-size:22px; padding:10px 16px; border-radius:12px; border:none; color:#fff;
    background:linear-gradient(145deg,var(--blue1),var(--blue2)); cursor:pointer;
    box-shadow:0 4px 10px rgba(37,99,235,0.3); transition:transform .1s, box-shadow .2s;
  }
  .btn:hover{ transform:translateY(-2px); box-shadow:0 6px 14px rgba(37,99,235,0.4); }
  .btn-ghost{ background:#fff; border:2px solid var(--blue1); color:var(--title); box-shadow:none; }
  .btn-ghost:hover{ background:#DBEAFE; }

  #toolbar{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin:10px 0 16px; }

  /* 題面與視覺區 */
  #problem{ font-size:40px; font-weight:800; margin:10px 0 6px; }
  #knownRow{ display:flex; justify-content:center; gap:8px; margin:6px 0 12px; }
  .dot{ width:28px; height:28px; border-radius:50%; background:var(--blue1); box-shadow:0 1px 0 rgba(0,0,0,.08); }

  .tray{ background:#F0F5FF; border:2px dashed #BFDBFE; border-radius:14px; padding:12px; margin:12px auto; max-width:620px; }
  .trayTitle{ font-size:16px; color:var(--title); margin:0 0 8px; }
  #drop{ min-height:60px; display:flex; flex-wrap:wrap; gap:8px; justify-content:center; padding:10px; background:#fff; border:3px solid #93C5FD; border-radius:14px; }
  #pool{ min-height:60px; display:flex; flex-wrap:wrap; gap:8px; justify-content:center; }
  #pool .dot{ cursor:grab; }
  .dragging{ opacity:.9; transform:scale(1.06); filter:saturate(1.1); }

  #feedback{ font-size:22px; font-weight:800; min-height:30px; margin-top:8px; }
  #stats{ font-size:18px; color:var(--blue2); font-weight:700; margin-top:8px; }

  @media (max-width:480px){
    #problem{ font-size:34px; }
    .dot{ width:26px; height:26px; }
  }
</style>
</head>
<body>
  <h1>數字分解練習</h1>
  <div id="subtitle">一年級｜10 以內</div>

  <div id="toolbar">
    <button class="btn" id="checkBtn">✅ 確認答案</button>
    <button class="btn btn-ghost" id="nextBtn">下一題</button>
  </div>

  <div id="problem">—</div>
  <div id="knownRow"></div>

  <div class="tray" aria-label="拖曳目標區">
    <div class="trayTitle">把圓點拖到這裡 ➜ 答案框</div>
    <div id="drop"></div>
  </div>

  <div class="tray" aria-label="可用圓點">
    <div class="trayTitle">可拖曳的圓點</div>
    <div id="pool"></div>
  </div>

  <div id="feedback"></div>
  <div id="stats">完成題數：0　｜　答錯次數：0</div>

<script>
  // 狀態
  let target=0, known=0, answer=0;
  let correctCount=0, wrongCount=0;

  // 節點
  const problem=document.getElementById('problem');
  const knownRow=document.getElementById('knownRow');
  const pool=document.getElementById('pool');
  const drop=document.getElementById('drop');
  const feedback=document.getElementById('feedback');
  const stats=document.getElementById('stats');
  const nextBtn=document.getElementById('nextBtn');
  const checkBtn=document.getElementById('checkBtn');

  // 工具
  const randInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
  const updateStats=()=>{ stats.textContent=`完成題數：${correctCount}　｜　答錯次數：${wrongCount}`; };

  // 出題：2~10，顯示已知數量的圓點，只在答案框檢查數量
  function newQuestion(){
    feedback.textContent='';
    drop.innerHTML=''; pool.innerHTML=''; knownRow.innerHTML='';

    target=randInt(2,10);
    const a=randInt(1,target-1);
    known=Math.random()<0.5?a:target-a; // 題面已知
    answer=target-known;                // 需湊出的數

    const leftBox=Math.random()<0.5;
    problem.textContent = leftBox
      ? `${target} → ☐ + ${known}`
      : `${target} → ${known} + ☐`;

    for(let i=0;i<known;i++) knownRow.appendChild(makeDot(false));

    // 提供足量可拖曳圓點（至少 10 顆，避免不夠）
    const poolCount=Math.max(10, answer);
    for(let i=0;i<poolCount;i++) pool.appendChild(makeDot(true));
  }

  // 產生圓點
  function makeDot(draggable){
    const d=document.createElement('div');
    d.className='dot';
    if(!draggable) return d;

    let startX=0, startY=0, ghost=null;

    const onPointerDown=(e)=>{
      e.preventDefault();
      const rect=d.getBoundingClientRect();
      startX=e.clientX-rect.left; startY=e.clientY-rect.top;
      ghost=d.cloneNode(true);
      ghost.style.position='fixed';
      ghost.style.left=rect.left+'px';
      ghost.style.top=rect.top+'px';
      ghost.style.pointerEvents='none';
      ghost.classList.add('dragging');
      document.body.appendChild(ghost);
      document.addEventListener('pointermove', onMove);
      document.addEventListener('pointerup', onUp, {once:true});
    };
    const onMove=(e)=>{
      if(!ghost) return;
      ghost.style.left=(e.clientX-startX)+'px';
      ghost.style.top=(e.clientY-startY)+'px';
    };
    const onUp=(e)=>{
      document.removeEventListener('pointermove', onMove);
      if(!ghost) return;
      const r=drop.getBoundingClientRect();
      const x=e.clientX, y=e.clientY;
      const inDrop=(x>=r.left && x<=r.right && y>=r.top && y<=r.bottom);
      ghost.remove(); ghost=null;
      if(inDrop){ drop.appendChild(simpleDot()); }
    };

    d.addEventListener('pointerdown', onPointerDown);
    return d;
  }

  // 放入答案框的圓點：可點擊移回 pool
  function simpleDot(){
    const d=document.createElement('div');
    d.className='dot';
    d.style.cursor='pointer';
    d.title='點一下移回下方圓點區';
    d.addEventListener('click', ()=>{ pool.appendChild(makeDot(true)); d.remove(); });
    return d;
  }

  function checkAnswer(){
    const count=drop.children.length;
    if(count===answer){
      feedback.style.color='var(--ok)';
      feedback.textContent='✅ 答對了！';
      correctCount++; updateStats();
      setTimeout(newQuestion,1200);
    }else{
      feedback.style.color='var(--no)';
      feedback.textContent='❌ 再試一次';
      wrongCount++; updateStats();
    }
  }

  nextBtn.addEventListener('click', newQuestion);
  checkBtn.addEventListener('click', checkAnswer);

  updateStats();
  newQuestion();
</script>
</body>
</html>
