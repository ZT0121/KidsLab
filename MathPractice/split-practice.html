<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>數字分解練習｜KidsLab</title>

<link rel="stylesheet" href="../KidsLabTheme.css">
<link rel="preload" as="font" href="../BpmfIansui-Regular.ttf" type="font/ttf" crossorigin>

<style>
/* 置中與樣式修正版 */
.center-wrap {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  gap: 14px;
  width: 100%;
}

/* 外框容器 */
.tray {
  border: 2px dashed #BFDBFE;
  border-radius: 14px;
  padding: 16px;
  margin: 16px auto;
  max-width: 680px;
  background: transparent;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

/* 答案框與可拖曳區 */
#drop, #pool {
  min-height: 80px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 12px;
  border: 3px dashed #93C5FD;
  border-radius: 14px;
  background: transparent;
  width: 100%;
  box-sizing: border-box;
}

/* 圓點 */
.dot {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: #7C9CBF;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  cursor: grab;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* 已知數字的圓點列置中修正 */
#knownRow {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  margin: 12px auto;
  flex-wrap: wrap;
  width: 100%;
}

  
/* 拖曳中 */
.dragging {
  opacity: 0.9;
  transform: scale(1.06);
  filter: saturate(1.1);
}

  #problem {
  font-size: 28px; /* 和 h1 標題同級大小 */
  font-weight: 700;
  color: var(--title);
  margin: 12px 0;
  text-align: center;
  font-family: 'BpmfIansui','Iansui','Noto Sans TC',sans-serif;
}

</style>

</head>

<body>
  <nav class="top-nav light">
    <a href="../index.html">🏠 首頁</a>
    <a href="../DailyTask/">🎯 每日任務</a>
    <a href="../ZhuyinPractice/">ㄅㄆㄇ 注音練習</a>
    <a href="../MathPractice/split-practice.html" class="active">🔢 數字分解練習</a>
  </nav>

  <h1>🔢 數字分解練習</h1>
  <div id="subtitle">一年級｜10 以內</div>



  <div id="problem">—</div>
  <div id="knownRow"></div>
  
  <div id="toolbar">
    <button class="btn" id="checkBtn">✅ 確認答案</button>
    <button class="btn btn-ghost" id="nextBtn">下一題</button>
  </div>
  
  <div class="tray">
    <div class="trayTitle">把圓點拖到這裡 ➜ 答案框</div>
    <div id="drop"></div>
  </div>

  <div class="tray">
    <div class="trayTitle">可拖曳的圓點</div>
    <div id="pool" class="center-wrap"></div>
  </div>

  <div id="feedback"></div>
  <div id="stats">完成題數：0　｜　答錯次數：0</div>

  <footer>© 2025 KidsLab · Created with ❤️ by ZTing</footer>

<script>
let target=0, known=0, answer=0, correctCount=0, wrongCount=0;
const problem=document.getElementById('problem');
const knownRow=document.getElementById('knownRow');
const pool=document.getElementById('pool');
const drop=document.getElementById('drop');
const feedback=document.getElementById('feedback');
const stats=document.getElementById('stats');
const nextBtn=document.getElementById('nextBtn');
const checkBtn=document.getElementById('checkBtn');
const randInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const updateStats=()=>{stats.textContent=`完成題數：${correctCount}　｜　答錯次數：${wrongCount}`;};

function newQuestion(){
  feedback.textContent='';
  drop.innerHTML='';
  pool.innerHTML='';
  knownRow.innerHTML='';
  target=randInt(2,10);
  const a=randInt(1,target-1);
  known=Math.random()<0.5?a:target-a;
  answer=target-known;
  const leftBox=Math.random()<0.5;
  problem.textContent = leftBox ? `${target} → ☐ + ${known}` : `${target} → ${known} + ☐`;
  for(let i=0;i<known;i++) knownRow.appendChild(makeDot(false));
  const poolCount=Math.max(10, answer);
  for(let i=0;i<poolCount;i++) pool.appendChild(makeDot(true));
}

/* ✅ 浮出提示框 */
function showPopup(text, isCorrect) {
  const popup = document.createElement("div");
  popup.className = `result-popup ${isCorrect ? "correct" : "wrong"}`;
  popup.textContent = text;
  document.body.appendChild(popup);
  setTimeout(() => popup.classList.add("show"), 10);
  setTimeout(() => {
    popup.classList.remove("show");
    setTimeout(() => popup.remove(), 300);
  }, 1000);
}

/* ===== 改良可拖曳支援滑鼠＋手機 ===== */
function makeDot(draggable){
  const d=document.createElement('div');
  d.className='dot';
  if(!draggable) return d;

  let ghost=null;

  function startDrag(x,y){
    const rect=d.getBoundingClientRect();
    ghost=d.cloneNode(true);
    ghost.style.position='fixed';
    ghost.style.left=rect.left+'px';
    ghost.style.top=rect.top+'px';
    ghost.style.pointerEvents='none';
    ghost.classList.add('dragging');
    document.body.appendChild(ghost);
  }
  function moveDrag(x,y){
    if(!ghost) return;
    ghost.style.left=(x-15)+'px';
    ghost.style.top=(y-15)+'px';
  }
  function endDrag(x,y){
    if(!ghost) return;
    const r=drop.getBoundingClientRect();
    const inDrop=(x>=r.left&&x<=r.right&&y>=r.top&&y<=r.bottom);
    ghost.remove();
    ghost=null;
    if(inDrop){ drop.appendChild(simpleDot()); }
  }

  // 滑鼠事件
  d.addEventListener('pointerdown', e=>{
    e.preventDefault();
    startDrag(e.clientX,e.clientY);
    const move=e2=>moveDrag(e2.clientX,e2.clientY);
    const up=e2=>{
      document.removeEventListener('pointermove',move);
      document.removeEventListener('pointerup',up);
      endDrag(e2.clientX,e2.clientY);
    };
    document.addEventListener('pointermove',move);
    document.addEventListener('pointerup',up);
  });

  // 觸控事件
  d.addEventListener('touchstart', e=>{
    const t=e.touches[0];
    startDrag(t.clientX,t.clientY);
  });
  d.addEventListener('touchmove', e=>{
    const t=e.touches[0];
    moveDrag(t.clientX,t.clientY);
  });
  d.addEventListener('touchend', e=>{
    const t=e.changedTouches[0];
    endDrag(t.clientX,t.clientY);
  });

  return d;
}

function simpleDot(){
  const d=document.createElement('div');
  d.className='dot';
  d.style.cursor='pointer';
  d.title='點一下移回下方圓點區';
  d.addEventListener('click',()=>{
    pool.appendChild(makeDot(true));
    d.remove();
  });
  return d;
}

function checkAnswer(){
  const count=drop.children.length;
  if(count===answer){
    showPopup("✅ 答對了！", true);
    feedback.style.color='var(--ok)';
    feedback.textContent='✅ 答對了！';
    correctCount++;
    updateStats();
    setTimeout(newQuestion,1200);
  }else{
    showPopup("❌ 再試一次", false);
    feedback.style.color='var(--no)';
    feedback.textContent='❌ 再試一次';
    wrongCount++;
    updateStats();
  }
}

nextBtn.addEventListener('click',newQuestion);
checkBtn.addEventListener('click',checkAnswer);
updateStats();
newQuestion();
</script>

<style>
/* ✅ 浮出提示框樣式 */
.result-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  padding: 20px 36px;
  border-radius: 12px;
  font-size: 36px;
  font-weight: bold;
  color: #fff;
  text-align: center;
  opacity: 0;
  z-index: 999;
  transition: all 0.3s ease;
  pointer-events: none;
}
.result-popup.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
}
.result-popup.correct {
  background: rgba(76, 175, 80, 0.92);
  box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
}
.result-popup.wrong {
  background: rgba(244, 67, 54, 0.9);
  box-shadow: 0 0 20px rgba(244, 67, 54, 0.5);
}
</style>


</body>
</html>
