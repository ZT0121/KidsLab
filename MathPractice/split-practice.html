<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>數字分解練習｜KidsLab</title>

<link rel="stylesheet" href="../KidsLabTheme.css">
<link rel="preload" as="font" href="../BpmfIansui-Regular.ttf" type="font/ttf" crossorigin>
</head>

<body>
  <nav class="top-nav light">
    <a href="../index.html">🏠 首頁</a>
    <a href="../DailyTask/">🎯 每日任務</a>
    <a href="../ZhuyinPractice/">ㄅㄆㄇ 注音練習</a>
    <a href="../MathPractice/split-practice.html" class="active">🔢 數字分解練習</a>
  </nav>

  <h1>🔢 數字分解練習</h1>
  <div id="subtitle">一年級｜10 以內</div>

  <div id="toolbar">
    <button class="btn" id="checkBtn">✅ 確認答案</button>
    <button class="btn btn-ghost" id="nextBtn">下一題</button>
  </div>

  <div id="problem">—</div>
  <div id="knownRow"></div>

  <div class="tray">
    <div class="trayTitle">把圓點拖到這裡 ➜ 答案框</div>
    <div id="drop"></div>
  </div>

  <div class="tray">
    <div class="trayTitle">可拖曳的圓點</div>
    <div id="pool" class="center-wrap"></div>
  </div>

  <div id="feedback"></div>
  <div id="stats">完成題數：0　｜　答錯次數：0</div>

  <footer>© 2025 KidsLab · Created with ❤️ by ZTing</footer>

  <script>
    // 保留功能不變
    let target=0, known=0, answer=0, correctCount=0, wrongCount=0;
    const problem=document.getElementById('problem');
    const knownRow=document.getElementById('knownRow');
    const pool=document.getElementById('pool');
    const drop=document.getElementById('drop');
    const feedback=document.getElementById('feedback');
    const stats=document.getElementById('stats');
    const nextBtn=document.getElementById('nextBtn');
    const checkBtn=document.getElementById('checkBtn');
    const randInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
    const updateStats=()=>{stats.textContent=`完成題數：${correctCount}　｜　答錯次數：${wrongCount}`;};

    function newQuestion(){
      feedback.textContent=''; drop.innerHTML=''; pool.innerHTML=''; knownRow.innerHTML='';
      target=randInt(2,10); const a=randInt(1,target-1);
      known=Math.random()<0.5?a:target-a; answer=target-known;
      const leftBox=Math.random()<0.5;
      problem.textContent = leftBox ? `${target} → ☐ + ${known}` : `${target} → ${known} + ☐`;
      for(let i=0;i<known;i++) knownRow.appendChild(makeDot(false));
      const poolCount=Math.max(10, answer); for(let i=0;i<poolCount;i++) pool.appendChild(makeDot(true));
    }

    function makeDot(draggable){
      const d=document.createElement('div'); d.className='dot';
      if(!draggable) return d;
      let startX=0,startY=0,ghost=null;
      const onPointerDown=(e)=>{e.preventDefault();const rect=d.getBoundingClientRect();
        startX=e.clientX-rect.left;startY=e.clientY-rect.top;
        ghost=d.cloneNode(true);ghost.style.position='fixed';ghost.style.left=rect.left+'px';ghost.style.top=rect.top+'px';
        ghost.style.pointerEvents='none';ghost.classList.add('dragging');document.body.appendChild(ghost);
        document.addEventListener('pointermove',onMove);document.addEventListener('pointerup',onUp,{once:true});};
      const onMove=(e)=>{if(!ghost)return;ghost.style.left=(e.clientX-startX)+'px';ghost.style.top=(e.clientY-startY)+'px';};
      const onUp=(e)=>{document.removeEventListener('pointermove',onMove);if(!ghost)return;
        const r=drop.getBoundingClientRect();const x=e.clientX,y=e.clientY;const inDrop=(x>=r.left&&x<=r.right&&y>=r.top&&y<=r.bottom);
        ghost.remove();ghost=null;if(inDrop){drop.appendChild(simpleDot());}};
      d.addEventListener('pointerdown',onPointerDown);return d;
    }

    function simpleDot(){
      const d=document.createElement('div');d.className='dot';d.style.cursor='pointer';
      d.title='點一下移回下方圓點區';d.addEventListener('click',()=>{pool.appendChild(makeDot(true));d.remove();});
      return d;
    }

    function checkAnswer(){
      const count=drop.children.length;
      if(count===answer){feedback.style.color='var(--ok)';feedback.textContent='✅ 答對了！';correctCount++;updateStats();setTimeout(newQuestion,1200);}
      else{feedback.style.color='var(--no)';feedback.textContent='❌ 再試一次';wrongCount++;updateStats();}
    }

    nextBtn.addEventListener('click',newQuestion);
    checkBtn.addEventListener('click',checkAnswer);
    updateStats(); newQuestion();
  </script>
</body>
</html>
