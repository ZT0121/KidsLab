<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>æ³¨éŸ³ç·´ç¿’ï½œKidsLab</title>

<link rel="stylesheet" href="../KidsLabTheme.css">
<link rel="preload" as="font" href="../BpmfIansui-Regular.ttf" type="font/ttf" crossorigin>
<link rel="preload" as="font" href="../Iansui-Regular.ttf" type="font/ttf" crossorigin>
</head>

<body>
  <nav class="top-nav light">
    <a href="../index.html">ğŸ  é¦–é </a>
    <a href="../DailyTask/">ğŸ¯ æ¯æ—¥ä»»å‹™</a>
    <a href="../ZhuyinPractice/" class="active">ã„…ã„†ã„‡ æ³¨éŸ³ç·´ç¿’</a>
    <a href="../MathPractice/split-practice.html">ğŸ”¢ æ•¸å­—åˆ†è§£ç·´ç¿’</a>
  </nav>

  <h1>ã„…ã„†ã„‡ æ³¨éŸ³ç·´ç¿’</h1>

  <div id="toolbar">
    <button class="btn" onclick="submitAnswer()">é€å‡º</button>
    <button class="btn" onclick="nextWord()">ä¸‹ä¸€é¡Œ</button>
    <button class="btn btn-ghost" onclick="clearSelected()">æ¸…é™¤</button>
    <button class="btn" onclick="startChallenge()">ğŸš€ æŒ‘æˆ°æ¨¡å¼</button>
  </div>

  <div id="progress">è‡ªç”±ç·´ç¿’</div>

  <div id="word">
    <span id="wordText" style="font-family:'Iansui','Noto Sans TC';font-size:72px;text-shadow:1px 1px 2px rgba(0,0,0,0.15);">è©èª</span>
    <button id="playBtn" class="btn btn-ghost" onclick="playTTS()">ğŸ”Š å†è½ä¸€æ¬¡</button>
  </div>

  <div id="selected"></div>
  <div id="buttons"></div>
  <div id="feedback"></div>

  <footer>Â© 2025 KidsLab Â· Created with â¤ï¸ by ZTing</footer>

  <script src="words.js"></script>
  <script src="zhuyin-all.js"></script>
  <script>
    // ä¿ç•™åŸåŠŸèƒ½é‚è¼¯
    let current=-1,selected=[],isChallenge=false;
    const ROUND_TOTAL=10; let roundCount=0,roundCorrect=0;
    function getDistractors(correct){const need=Math.max(3,correct.length*2);const d=[];while(d.length<need){const c=allSyllables[Math.floor(Math.random()*allSyllables.length)];if(!correct.includes(c)&&!d.includes(c))d.push(c);}return d;}
    function nextWord(){selected=[];let idx;do{idx=Math.floor(Math.random()*words.length);}while(idx===current);current=idx;const w=words[current];document.getElementById("wordText").textContent=w.char;document.getElementById("selected").textContent="";document.getElementById("feedback").textContent="";updateProgressText();renderOptions();playTTS();}
    function updateProgressText(){document.getElementById("progress").textContent=isChallenge?`æŒ‘æˆ°æ¨¡å¼ï¼šç¬¬ ${Math.min(roundCount+1,ROUND_TOTAL)} / ${ROUND_TOTAL} é¡Œ`:"è‡ªç”±ç·´ç¿’";}
    function renderOptions(){const btnDiv=document.getElementById("buttons");btnDiv.innerHTML="";const correct=words[current].zhuyin;let options=[...correct,...getDistractors(correct)];options.sort(()=>Math.random()-.5);options.forEach(syl=>{const btn=document.createElement("button");btn.textContent=syl;btn.className="btn";btn.onclick=()=>{selected.push(syl);document.getElementById("selected").textContent=selected.join(" ");};btnDiv.appendChild(btn);});}
    function submitAnswer(){if(!words[current])return;if(selected.length===0){setFeedback("å…ˆé¸æ³¨éŸ³å†é€å‡ºå–”ï½","hint");return;}const ans=selected.join(" ");const correct=words[current].zhuyin.join(" ");if(isChallenge){roundCount++;if(ans===correct){roundCorrect++;setFeedback("âœ… æ­£ç¢ºï¼","ok");setTimeout(nextWord,3000);}else{setFeedback(`âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºç­”æ¡ˆï¼š${correct}`,"err");setTimeout(nextWord,3000);}if(roundCount>=ROUND_TOTAL)setTimeout(showChallengeSummary,600);}else{if(ans===correct){setFeedback("âœ… æ­£ç¢ºï¼","ok");setTimeout(nextWord,3000);}else setFeedback(`âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºç­”æ¡ˆï¼š${correct}`,"err");}}
    function startChallenge(){isChallenge=true;roundCount=0;roundCorrect=0;setFeedback("ğŸš€ æŒ‘æˆ°é–‹å§‹ï¼å…± 10 é¡Œ","ok");nextWord();}
    function showChallengeSummary(){const rate=Math.round((roundCorrect/ROUND_TOTAL)*100);const msg=`æœ¬è¼ªæˆç¸¾ï¼š${roundCorrect} / ${ROUND_TOTAL}\næ­£ç¢ºç‡ï¼š${rate}%\nåšå¾—å¥½ï¼å†æŒ‘æˆ°ä¸€æ¬¡å§ï½`;document.getElementById("summary").textContent=msg;document.getElementById("overlay").style.display="flex";}
    function restartRound(){isChallenge=true;roundCount=0;roundCorrect=0;document.getElementById("overlay").style.display="none";nextWord();}
    function setFeedback(t,cls){const e=document.getElementById("feedback");e.textContent=t;e.className=cls;}
    function clearSelected(){selected=[];document.getElementById("selected").textContent="";setFeedback("","");}
    function playTTS(){const w=words[current];if(!w)return;if("speechSynthesis"in window){speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(w.char);u.lang="zh-TW";speechSynthesis.speak(u);}}
    nextWord();
  </script>

  <div id="overlay" style="position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;">
    <div id="panel" style="background:#fff;border-radius:16px;max-width:360px;width:90%;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.25);text-align:left;">
      <h2 style="margin:0 0 10px;font-size:22px;color:#1E3A8A;">æŒ‘æˆ°çµæŸ ğŸ‰</h2>
      <p id="summary" style="margin:8px 0;color:#1E40AF;line-height:1.6;white-space:pre-line;"></p>
      <div class="actions" style="display:flex;gap:20px;justify-content:center;margin-top:18px;">
        <button class="btn" onclick="restartRound()">å†æŒ‘æˆ°ä¸€æ¬¡</button>
        <button class="btn btn-ghost" onclick="(document.getElementById('overlay').style.display='none', isChallenge=false, setFeedback('å›åˆ°è‡ªç”±ç·´ç¿’','ok'), updateProgressText())">è¿”å›è‡ªç”±ç·´ç¿’</button>
      </div>
    </div>
  </div>
</body>
</html>
