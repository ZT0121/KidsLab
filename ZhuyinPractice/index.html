<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>æ³¨éŸ³ç·´ç¿’ï½œKidsLab</title>

<link rel="stylesheet" href="../KidsLabTheme.css">
<link rel="preload" as="font" href="../BpmfIansui-Regular.ttf" type="font/ttf" crossorigin>
<link rel="preload" as="font" href="../Iansui-Regular.ttf" type="font/ttf" crossorigin>

<style>
#toolbar {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
  margin: 16px auto 20px;
}
#progress {
  font-size: 26px;
  font-weight: 700;
  color: var(--title);
  text-align: center;
  margin-bottom: 18px;
  letter-spacing: 1px;
}
#word {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin-bottom: 24px;
}
#playBtn {
  font-size: 20px;
  margin-top: 10px;
  padding: 8px 18px;
  border-radius: 10px;
  border: 2px solid var(--b1);
  background: #fff;
  color: var(--title);
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(124,156,191,0.25);
  transition: 0.2s;
}
#playBtn:hover {
  background: var(--b1);
  color: #fff;
}
#wordText {
  font-family:'Iansui','Noto Sans TC';
  font-size:72px;
  text-shadow:1px 1px 2px rgba(0,0,0,0.15);
  margin-bottom: 6px;
}
#selected {
  text-align: center;
  font-size: 28px;
  color: var(--ink);
  margin: 12px 0 16px;
  min-height: 32px;
}
#buttons {
  display: grid;
  grid-template-columns: repeat(4, minmax(70px, 1fr));
  gap: 12px;
  max-width: 680px;
  margin: 0 auto 24px;
  justify-items: center;
}
#buttons .btn {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  white-space: nowrap;
  min-height: 48px;
}
#feedback {
  text-align: center;
  font-size: 20px;
  font-weight: 600;
  margin-top: 12px;
}

/* âœ… æµ®å‡ºæç¤ºæ¡† */
.result-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  padding: 20px 36px;
  border-radius: 12px;
  font-size: 36px;
  font-weight: bold;
  color: #fff;
  text-align: center;
  opacity: 0;
  z-index: 999;
  transition: all 0.3s ease;
  pointer-events: none;
}
.result-popup.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
}
.result-popup.correct {
  background: rgba(76, 175, 80, 0.92);
  box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
}
.result-popup.wrong {
  background: rgba(244, 67, 54, 0.9);
  box-shadow: 0 0 20px rgba(244, 67, 54, 0.5);
}
@media (max-width: 600px) {
  #buttons {
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    max-width: 95%;
  }
  #wordText { font-size: 56px; }
}
</style>
</head>

<body>
  <nav class="top-nav light">
    <a href="../index.html">ğŸ  é¦–é </a>
    <a href="../DailyTask/">ğŸ¯ æ¯æ—¥ä»»å‹™</a>
    <a href="../ZhuyinPractice/" class="active">ã„…ã„†ã„‡ æ³¨éŸ³ç·´ç¿’</a>
    <a href="../MathPractice/split-practice.html">ğŸ”¢ æ•¸å­—åˆ†è§£ç·´ç¿’</a>
  </nav>

  <h1>ã„…ã„†ã„‡ æ³¨éŸ³ç·´ç¿’</h1>

  <div id="progress">è‡ªç”±ç·´ç¿’</div> 
  <div id="toolbar">
    <button class="btn" onclick="startChallenge()">ğŸš€ æŒ‘æˆ°æ¨¡å¼</button>
  </div>

  <div id="word">
    <span id="wordText">è©èª</span>
    <button id="playBtn" onclick="playTTS()">ğŸ”Š å†è½ä¸€æ¬¡</button>
  </div>

  <div id="selected"></div>
  <div id="buttons"></div>
  <div id="feedback"></div>

  <div style="display:flex;justify-content:center;gap:12px;flex-wrap:wrap;">
    <button class="btn" onclick="submitAnswer()">é€å‡º</button>
    <button class="btn" onclick="nextWord()">ä¸‹ä¸€é¡Œ</button>
    <button class="btn btn-ghost" onclick="clearSelected()">æ¸…é™¤</button>
  </div>

  <footer>Â© 2025 KidsLab Â· Created with â¤ï¸ by ZTing</footer>

  <script src="words.js"></script>
  <script src="zhuyin-all.js"></script>
  <script>
    let current=-1,selected=[],isChallenge=false;
    const ROUND_TOTAL=10; let roundCount=0,roundCorrect=0;

    function getDistractors(correct){
      const total=8;
      const need=total-correct.length;
      const d=[];
      while(d.length<need){
        const c=allSyllables[Math.floor(Math.random()*allSyllables.length)];
        if(!correct.includes(c)&&!d.includes(c))d.push(c);
      }
      return d;
    }

    function nextWord(){
      selected=[];
      let idx;
      do{ idx=Math.floor(Math.random()*words.length);}while(idx===current);
      current=idx;
      const w=words[current];
      document.getElementById("wordText").textContent=w.char;
      document.getElementById("selected").textContent="";
      document.getElementById("feedback").textContent="";
      updateProgressText();
      renderOptions();
      playTTS();
    }

    function updateProgressText(){
      document.getElementById("progress").textContent=
        isChallenge?`æŒ‘æˆ°æ¨¡å¼ï¼šç¬¬ ${Math.min(roundCount+1,ROUND_TOTAL)} / ${ROUND_TOTAL} é¡Œ`:"è‡ªç”±ç·´ç¿’";
    }

    function renderOptions(){
      const btnDiv=document.getElementById("buttons");
      btnDiv.innerHTML="";
      const correct=words[current].zhuyin;
      let options=[...correct,...getDistractors(correct)];
      options.sort(()=>Math.random()-.5);
      options.slice(0,8).forEach(syl=>{
        const btn=document.createElement("button");
        btn.textContent=syl;
        btn.className="btn";
        btn.onclick=()=>{
          selected.push(syl);
          document.getElementById("selected").textContent=selected.join(" ");
        };
        btnDiv.appendChild(btn);
      });
    }

    function showPopup(text, isCorrect) {
      const popup = document.createElement("div");
      popup.className = `result-popup ${isCorrect ? "correct" : "wrong"}`;
      popup.textContent = text;
      document.body.appendChild(popup);
      setTimeout(() => popup.classList.add("show"), 10);
      setTimeout(() => {
        popup.classList.remove("show");
        setTimeout(() => popup.remove(), 300);
      }, 1000);
    }

    function submitAnswer(){
      if(!words[current])return;
      if(selected.length===0){setFeedback("å…ˆé¸æ³¨éŸ³å†é€å‡ºå–”ï½","hint");return;}
      const ans=selected.join(" ");
      const correct=words[current].zhuyin.join(" ");
      if(isChallenge){
        roundCount++;
        if(ans===correct){
          showPopup("âœ… ç­”å°äº†ï¼", true);
          setFeedback("âœ… æ­£ç¢ºï¼", "ok");
          setTimeout(nextWord,2500);
        } else {
          showPopup("âŒ éŒ¯èª¤ï½", false);
          setFeedback(`âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºç­”æ¡ˆï¼š${correct}`, "err");
          setTimeout(nextWord,2500);
        }
        if(roundCount>=ROUND_TOTAL)setTimeout(showChallengeSummary,600);
      }else{
        if(ans===correct){
          showPopup("âœ… ç­”å°äº†ï¼", true);
          setFeedback("âœ… æ­£ç¢ºï¼","ok");
          setTimeout(nextWord,2500);
        } else {
          showPopup("âŒ éŒ¯èª¤ï½", false);
          setFeedback(`âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºç­”æ¡ˆï¼š${correct}`,"err");
        }
      }
    }

    function startChallenge(){
      isChallenge=true;
      roundCount=0;
      roundCorrect=0;
      setFeedback("ğŸš€ æŒ‘æˆ°é–‹å§‹ï¼å…± 10 é¡Œ","ok");
      nextWord();
    }

    function showChallengeSummary(){
      const rate=Math.round((roundCorrect/ROUND_TOTAL)*100);
      const msg=`æœ¬è¼ªæˆç¸¾ï¼š${roundCorrect} / ${ROUND_TOTAL}\næ­£ç¢ºç‡ï¼š${rate}%\nåšå¾—å¥½ï¼å†æŒ‘æˆ°ä¸€æ¬¡å§ï½`;
      document.getElementById("summary").textContent=msg;
      document.getElementById("overlay").style.display="flex";
    }

    function restartRound(){
      isChallenge=true;
      roundCount=0;
      roundCorrect=0;
      document.getElementById("overlay").style.display="none";
      nextWord();
    }

    function setFeedback(t,cls){
      const e=document.getElementById("feedback");
      e.textContent=t;
      e.className=cls;
    }

    function clearSelected(){
      selected=[];
      document.getElementById("selected").textContent="";
      setFeedback("","");
    }

    function playTTS(){
      const w=words[current];
      if(!w)return;
      if("speechSynthesis"in window){
        speechSynthesis.cancel();
        const u=new SpeechSynthesisUtterance(w.char);
        u.lang="zh-TW";
        speechSynthesis.speak(u);
      }
    }

    nextWord();
  </script>

  <div id="overlay" style="position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;">
    <div id="panel" style="background:#fff;border-radius:16px;max-width:360px;width:90%;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.25);text-align:left;">
      <h2 style="margin:0 0 10px;font-size:22px;color:#1E3A8A;">æŒ‘æˆ°çµæŸ ğŸ‰</h2>
      <p id="summary" style="margin:8px 0;color:#1E40AF;line-height:1.6;white-space:pre-line;"></p>
      <div class="actions" style="display:flex;justify-content:center;align-items:center;gap:14px;margin-top:18px;flex-wrap:wrap;width:100%;box-sizing:border-box;">
        <button class="btn" style="white-space:nowrap;min-width:130px;" onclick="restartRound()">å†æŒ‘æˆ°ä¸€æ¬¡</button>
        <button class="btn btn-ghost" style="white-space:nowrap;min-width:130px;" onclick="(document.getElementById('overlay').style.display='none',isChallenge=false,setFeedback('å›åˆ°è‡ªç”±ç·´ç¿’','ok'),updateProgressText())">è¿”å›è‡ªç”±ç·´ç¿’</button>
      </div>
    </div>
  </div>
</body>
</html>

