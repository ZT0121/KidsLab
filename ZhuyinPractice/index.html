<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>注音練習｜KidsLab</title>

<link rel="stylesheet" href="../KidsLabTheme.css">
<link rel="preload" as="font" href="../BpmfIansui-Regular.ttf" type="font/ttf" crossorigin>
<link rel="preload" as="font" href="../Iansui-Regular.ttf" type="font/ttf" crossorigin>

<style>
/* ===== 新版注音練習排版 ===== */
#toolbar {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
  margin: 16px auto 20px;
}

#progress {
  font-size: 26px;
  font-weight: 700;
  color: var(--title);
  text-align: center;
  margin-bottom: 18px;
  letter-spacing: 1px;
}

#word {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin-bottom: 24px;
}

#playBtn {
  font-size: 20px;
  margin-top: 10px;
  padding: 8px 18px;
  border-radius: 10px;
  border: 2px solid var(--b1);
  background: #fff;
  color: var(--title);
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(124,156,191,0.25);
  transition: 0.2s;
}
#playBtn:hover {
  background: var(--b1);
  color: #fff;
}

#wordText {
  font-family:'Iansui','Noto Sans TC';
  font-size:72px;
  text-shadow:1px 1px 2px rgba(0,0,0,0.15);
  margin-bottom: 6px;
}

/* 已選注音 */
#selected {
  text-align: center;
  font-size: 28px;
  color: var(--ink);
  margin: 12px 0 16px;
  min-height: 32px;
}

/* 選項：每排固定 4 個 */
#buttons {
  display: grid;
  grid-template-columns: repeat(4, 1fr); /* ← 每列 4 格 */
  gap: 12px;
  max-width: 720px;      /* 視需要可調 */
  margin: 0 auto 20px;
}

#buttons .btn {
  width: 100%;
  display: flex;         /* 讓字置中 */
  align-items: center;
  justify-content: center;
  white-space: nowrap;   /* 不自動換行 */
  min-height: 48px;      /* 視覺一致 */
}



/* 回饋區 */
#feedback {
  text-align: center;
  font-size: 20px;
  font-weight: 600;
  margin-top: 12px;
}
</style>
</head>

<body>
  <nav class="top-nav light">
    <a href="../index.html">🏠 首頁</a>
    <a href="../DailyTask/">🎯 每日任務</a>
    <a href="../ZhuyinPractice/" class="active">ㄅㄆㄇ 注音練習</a>
    <a href="../MathPractice/split-practice.html">🔢 數字分解練習</a>
  </nav>

  <h1>ㄅㄆㄇ 注音練習</h1>

  <div id="progress">自由練習</div> 

  <div id="toolbar">

    <button class="btn" onclick="startChallenge()">🚀 挑戰模式</button>
  </div>

  <button id="playBtn" onclick="playTTS()">🔊 再聽一次</button>

  <div id="word">
    <span id="wordText">詞語</span>
  
  </div>

  <div id="selected"></div>
  <div id="buttons"></div>
  <div id="feedback"></div>

    <button class="btn" onclick="submitAnswer()">送出</button>
    <button class="btn" onclick="nextWord()">下一題</button>
    <button class="btn btn-ghost" onclick="clearSelected()">清除</button>

  <footer>© 2025 KidsLab · Created with ❤️ by ZTing</footer>

  <script src="words.js"></script>
  <script src="zhuyin-all.js"></script>
  <script>
    let current=-1,selected=[],isChallenge=false;
    const ROUND_TOTAL=10; let roundCount=0,roundCorrect=0;
    function getDistractors(correct){
  const total = 8; // 固定給 8 個選項
  const need = total - correct.length;
  const d=[];
  while(d.length<need){
    const c=allSyllables[Math.floor(Math.random()*allSyllables.length)];
    if(!correct.includes(c)&&!d.includes(c))d.push(c);
  }
  return d;
}

    function nextWord(){selected=[];let idx;do{idx=Math.floor(Math.random()*words.length);}while(idx===current);current=idx;const w=words[current];document.getElementById("wordText").textContent=w.char;document.getElementById("selected").textContent="";document.getElementById("feedback").textContent="";updateProgressText();renderOptions();playTTS();}
    function updateProgressText(){document.getElementById("progress").textContent=isChallenge?`挑戰模式：第 ${Math.min(roundCount+1,ROUND_TOTAL)} / ${ROUND_TOTAL} 題`:"自由練習";}
    function renderOptions(){const btnDiv=document.getElementById("buttons");btnDiv.innerHTML="";const correct=words[current].zhuyin;let options=[...correct,...getDistractors(correct)];options.sort(()=>Math.random()-.5);options.forEach(syl=>{const btn=document.createElement("button");btn.textContent=syl;btn.className="btn";btn.onclick=()=>{selected.push(syl);document.getElementById("selected").textContent=selected.join(" ");};btnDiv.appendChild(btn);});}
    function submitAnswer(){if(!words[current])return;if(selected.length===0){setFeedback("先選注音再送出喔～","hint");return;}const ans=selected.join(" ");const correct=words[current].zhuyin.join(" ");if(isChallenge){roundCount++;if(ans===correct){roundCorrect++;setFeedback("✅ 正確！","ok");setTimeout(nextWord,3000);}else{setFeedback(`❌ 錯誤，正確答案：${correct}`,"err");setTimeout(nextWord,3000);}if(roundCount>=ROUND_TOTAL)setTimeout(showChallengeSummary,600);}else{if(ans===correct){setFeedback("✅ 正確！","ok");setTimeout(nextWord,3000);}else setFeedback(`❌ 錯誤，正確答案：${correct}`,"err");}}
    function startChallenge(){isChallenge=true;roundCount=0;roundCorrect=0;setFeedback("🚀 挑戰開始！共 10 題","ok");nextWord();}
    function showChallengeSummary(){const rate=Math.round((roundCorrect/ROUND_TOTAL)*100);const msg=`本輪成績：${roundCorrect} / ${ROUND_TOTAL}\n正確率：${rate}%\n做得好！再挑戰一次吧～`;document.getElementById("summary").textContent=msg;document.getElementById("overlay").style.display="flex";}
    function restartRound(){isChallenge=true;roundCount=0;roundCorrect=0;document.getElementById("overlay").style.display="none";nextWord();}
    function setFeedback(t,cls){const e=document.getElementById("feedback");e.textContent=t;e.className=cls;}
    function clearSelected(){selected=[];document.getElementById("selected").textContent="";setFeedback("","");}
    function playTTS(){const w=words[current];if(!w)return;if("speechSynthesis"in window){speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(w.char);u.lang="zh-TW";speechSynthesis.speak(u);}}
    nextWord();
  </script>

  <div id="overlay" style="position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;">
    <div id="panel" style="background:#fff;border-radius:16px;max-width:360px;width:90%;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.25);text-align:left;">
      <h2 style="margin:0 0 10px;font-size:22px;color:#1E3A8A;">挑戰結束 🎉</h2>
      <p id="summary" style="margin:8px 0;color:#1E40AF;line-height:1.6;white-space:pre-line;"></p>
<div class="actions" style="
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 14px;
  margin-top: 18px;
  flex-wrap: wrap;
  width: 100%;
  box-sizing: border-box;
">
  <button class="btn" style="white-space: nowrap; min-width: 130px;" onclick="restartRound()">再挑戰一次</button>
  <button class="btn btn-ghost" style="white-space: nowrap; min-width: 130px;" onclick="(document.getElementById('overlay').style.display='none', isChallenge=false, setFeedback('回到自由練習','ok'), updateProgressText())">返回自由練習</button>
</div>


    </div>
  </div>
</body>
</html>
